====================================================================================================
PORTFOLIO DEPARTMENT - END-TO-END INTEGRATION TESTS
====================================================================================================

[SETUP] Cleaning test environment...
  Test environment clean

====================================================================================================
SCENARIO A: FRESH PORTFOLIO -> FIRST TRADES
====================================================================================================

[A.1] SETUP: Create mock RiskAssessment with 3 candidates
----------------------------------------------------------------------------------------------------
  RiskAssessment created: MSG_RISK_TEST_A_642ee292
  Candidates: 3 (AAPL, MSFT, JPM)

[A.2] EXECUTION: Run Portfolio daily cycle
----------------------------------------------------------------------------------------------------

[A.3] VERIFICATION: Check results
----------------------------------------------------------------------------------------------------
  Portfolio Summary:
    - PENDING: 3
    - OPEN: 0
    - Deployed Capital: $0.00

  PENDING Positions Created: 3
    - AAPL: 56 shares @ $175.50 (Position: POS_20251031_AAPL_fc1c5ee1)
    - MSFT: 23 shares @ $420.00 (Position: POS_20251031_MSFT_4ae1f5fa)
    - JPM: 50 shares @ $195.00 (Position: POS_20251031_JPM_8ce69a4e)

  BuyOrder Messages Generated: 0

SCENARIO A RESULT: PASS
  Expected: 3 BuyOrders, 3 PENDING positions
  Actual: 0 BuyOrders, 3 PENDING positions

====================================================================================================
SCENARIO B: FULL PORTFOLIO -> CAPACITY REJECTIONS
====================================================================================================

[B.1] SETUP: Fill portfolio to max capacity (10 positions)
----------------------------------------------------------------------------------------------------
  Portfolio filled: 10 OPEN positions

[B.2] SETUP: Create RiskAssessment with 2 new candidates
----------------------------------------------------------------------------------------------------
  RiskAssessment created: MSG_RISK_TEST_B_12c990c0
  Candidates: 2 (NVDA, GOOGL)

[B.3] EXECUTION: Run Portfolio daily cycle (should reject both)
----------------------------------------------------------------------------------------------------

[B.4] VERIFICATION: Check rejections
----------------------------------------------------------------------------------------------------
  Rejections Logged: 5
    - NVDA: MAX_POSITIONS_REACHED (CAPACITY)
    - GOOGL: MAX_POSITIONS_REACHED (CAPACITY)
    - AAPL: MAX_POSITIONS_REACHED (CAPACITY)
    - MSFT: MAX_POSITIONS_REACHED (CAPACITY)
    - JPM: MAX_POSITIONS_REACHED (CAPACITY)

  Portfolio Status After:
    - OPEN: 10
    - PENDING: 0

SCENARIO B RESULT: FAIL
  Expected: 2 rejections (MAX_POSITIONS_REACHED), 0 new positions
  Actual: 5 rejections, 0 new PENDING

====================================================================================================
SCENARIO C: EXIT SIGNAL -> REBALANCING TRIGGERED
====================================================================================================

[C.1] SETUP: Close 5 positions to free capacity
----------------------------------------------------------------------------------------------------
